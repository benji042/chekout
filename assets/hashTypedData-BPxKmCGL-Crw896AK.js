import{j as y,aw as b,a2 as I,C as T,a3 as h,aI as C,a4 as u,u as f,i as M,al as O,J as j,e as J,aj as N,am as W,an as k}from"./index-d4DvafWv.js";const z=`Ethereum Signed Message:
`;function Y(t){const e=typeof t=="string"?h(t):typeof t.raw=="string"?t.raw:C(t.raw),s=h(`${z}${u(e)}`);return b([s,e])}function _(t,e){return y(Y(t),e)}class q extends f{constructor({domain:e}){super(`Invalid domain "${M(e)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class A extends f{constructor({primaryType:e,types:s}){super(`Invalid primary type \`${e}\` must be one of \`${JSON.stringify(Object.keys(s))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class B extends f{constructor({type:e}){super(`Struct type "${e}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function F(t){const{domain:e,message:s,primaryType:a,types:n}=t,r=(i,o)=>{for(const S of i){const{name:x,type:m}=S,p=o[x],d=m.match(O);if(d&&(typeof p=="number"||typeof p=="bigint")){const[P,c,D]=d;j(p,{signed:c==="int",size:Number.parseInt(D,10)/8})}if(m==="address"&&typeof p=="string"&&!J(p))throw new N({address:p});const l=m.match(W);if(l){const[P,c]=l;if(c&&u(p)!==Number.parseInt(c,10))throw new k({expectedSize:Number.parseInt(c,10),givenSize:u(p)})}const g=n[m];g&&(K(m),r(g,p))}};if(n.EIP712Domain&&e){if(typeof e!="object")throw new q({domain:e});r(n.EIP712Domain,e)}if(a!=="EIP712Domain")if(n[a])r(n[a],s);else throw new A({primaryType:a,types:n})}function G({domain:t}){return[typeof(t==null?void 0:t.name)=="string"&&{name:"name",type:"string"},(t==null?void 0:t.version)&&{name:"version",type:"string"},(typeof(t==null?void 0:t.chainId)=="number"||typeof(t==null?void 0:t.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(t==null?void 0:t.verifyingContract)&&{name:"verifyingContract",type:"address"},(t==null?void 0:t.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function K(t){if(t==="address"||t==="bool"||t==="string"||t.startsWith("bytes")||t.startsWith("uint")||t.startsWith("int"))throw new B({type:t})}function H(t){const{domain:e={},message:s,primaryType:a}=t,n={EIP712Domain:G({domain:e}),...t.types};F({domain:e,message:s,primaryType:a,types:n});const r=["0x1901"];return e&&r.push(L({domain:e,types:n})),a!=="EIP712Domain"&&r.push(w({data:s,primaryType:a,types:n})),y(b(r))}function L({domain:t,types:e}){return w({data:t,primaryType:"EIP712Domain",types:e})}function w({data:t,primaryType:e,types:s}){const a=v({data:t,primaryType:e,types:s});return y(a)}function v({data:t,primaryType:e,types:s}){const a=[{type:"bytes32"}],n=[R({primaryType:e,types:s})];for(const r of s[e]){const[i,o]=E({types:s,name:r.name,type:r.type,value:t[r.name]});a.push(i),n.push(o)}return I(a,n)}function R({primaryType:t,types:e}){const s=T(V({primaryType:t,types:e}));return y(s)}function V({primaryType:t,types:e}){let s="";const a=$({primaryType:t,types:e});a.delete(t);const n=[t,...Array.from(a).sort()];for(const r of n)s+=`${r}(${e[r].map(({name:i,type:o})=>`${o} ${i}`).join(",")})`;return s}function $({primaryType:t,types:e},s=new Set){var n;const a=(n=t.match(/^\w*/u))==null?void 0:n[0];if(s.has(a)||e[a]===void 0)return s;s.add(a);for(const r of e[a])$({primaryType:r.type,types:e},s);return s}function E({types:t,name:e,type:s,value:a}){if(t[s]!==void 0)return[{type:"bytes32"},y(v({data:a,primaryType:s,types:t}))];if(s==="bytes")return a=`0x${(a.length%2?"0":"")+a.slice(2)}`,[{type:"bytes32"},y(a)];if(s==="string")return[{type:"bytes32"},y(T(a))];if(s.lastIndexOf("]")===s.length-1){const n=s.slice(0,s.lastIndexOf("[")),r=a.map(i=>E({name:e,type:n,types:t,value:i}));return[{type:"bytes32"},y(I(r.map(([i])=>i),r.map(([,i])=>i)))]}return[{type:s},a]}export{_ as X,H as Y};
